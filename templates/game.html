{% extends "base.html" %}

{% block title %}Q-RYER{% endblock %}

{% block head %}
  <!-- Mapbox GL CSS -->
  <!-- City Selector CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css" rel="stylesheet">
{% endblock %}

{% block content %}

  <!-- Loader -->
  <div id="pageLoader" class="page-loader">
    <div class="loader-content">
      <div class="spinner"></div>
      <h2 class="white100">Q-RYER</h2>
      <p class="white60">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>
  </div>


  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ -->
<div id="citySelectorModal" class="modal-overlay" style="display: none;">
    <div class="modal-content city-selector">
        <div class="modal-header">
            <h2>üèôÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</h2>
            <p>–í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫—É—Ä—å–µ—Ä–æ–º?</p>
        </div>
        
        <div class="modal-body">
            <div id="citiesList" class="cities-list">
                <!-- –ì–æ—Ä–æ–¥–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
</div>

  <!-- Overlay-->
   <div class="overlay">
      <h1 class="black100">–≠—Ç–æ –æ–≤–µ—Ä–µ–ª–µ–π —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∏–≥—Ä—É –Ω–∞ –¥–µ—Å–∫–µ</h1>
   </div>

  <!-- –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div id="debugPanel" class="debug-panel" style="display: none;">
    <div>GPS: <span id="debugGPS">‚ùå</span></div>
    <div>State: <span id="debugState">init</span></div>
    <div>Button: <span id="debugButton">‚Äî</span></div>
  </div>

  <!--Map Header —Å –±–∞–ª–∞–Ω—Å–æ–º-->
  <div class="map_header">
    <div class="balance">
      <h3 class="white100">$<span id="balanceAmount">0</span></h3>
    </div>
  </div>

  <!--Map Controls-->
  <div class="map_button">

    <!--Report Button (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–∫–∞–∑–µ)-->
    <button id="reportButton" class="icon_button" style="display: none;">
      <img src="{{ url_for('static', filename='img/icon/report.svg') }}" alt="Report" class="icon">
    </button>

    <!-- Modal Profile Settings -->
    <div id="profileSettingsModal" class="modal">
      <div class="modal-content">
        
        <!--Modal header-->
        <span class="modal_header" style="gap: 8px; justify-content: flex-start;">


          <!-- Back -->
          <span class="icon_button graybg" onclick="closeModal('profileSettingsModal'); openModal('profileModal');">
            <img src="{{ url_for('static', filename='img/icon/arrow_left.svg') }}" alt="Back" class="icon">
          </span>

          <h1 class="black100">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
          

        </span>
        
        <!--Modal body-->
        <div style="padding: 24px 16px 24px 16px; flex: 1;">
          
          <span style="display: flex; flex-direction: column; gap: 0px;">
            
            <!-- –°–µ–∫—Ü–∏—è: –ê–∫–∫–∞—É–Ω—Ç -->
            <div style="margin-bottom: 24px;">
              
              <!-- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ -->
              <button class="cell">
                <img src="{{ url_for('static', filename='img/icon/user.svg') }}" alt="–ü—Ä–æ—Ñ–∏–ª—å" class="icon_24">
                <h4 class="black100">–í—Å—Ç–∞–≤–∏—Ç—å —Å—é–¥–∞ login</h4>
                <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
              </button>

              <!-- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
              <button class="cell">
                <img src="{{ url_for('static', filename='img/icon/user.svg') }}" alt="–ü—Ä–æ—Ñ–∏–ª—å" class="icon_24">
                <h4 class="black100">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h4>
                <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
              </button>

                          <!-- –°–µ–∫—Ü–∏—è: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
            <div>
              
            <button class="cell">
                <img src="{{ url_for('static', filename='img/icon/info.svg') }}" alt="–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" class="icon_24">
                <h4 class="black100">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h4>
                <p class="black60" style="margin-left: auto; margin-right: 8px;">v1.0.0</p>
            </button>

              

            </div>
            
          <!-- Logout -->
              <button id="logoutBtn" class="cell" style="border-top: 1px solid var(--white20);">
                <img src="{{ url_for('static', filename='img/icon/door.svg') }}" alt="Support" class="icon_24">
                <h4 class="red100">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</h4>
          </button>
           
          </div>

            
          </span>
        </div>
      </div>
    </div>

    <!-- Modal Profile -->
    <div id="profileModal" class="modal">
      <div class="modal-content">

        <!--Modal header-->
        <span class="modal_header">
          <h1 class="black100">–ü—Ä–æ—Ñ–∏–ª—å</h1>
          <span class="icon_button graybg close" data-close="profileModal">
            <img src="{{ url_for('static', filename='img/icon/cross.svg') }}" alt="Close" class="icon">
          </span>
        </span>
        
        <!--Modal body-->
        <div style="padding: 24px 16px 24px 16px; flex: 1;">

          <span style="display: flex; flex-direction: column; gap: 0px;">

            <!--button class="cell" onclick="closeModal('profileModal'); openModal('profileSettingsModal');">
              <img src="{{ url_for('static', filename='img/icon/settings.svg') }}" alt="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" class="icon_24">
              <h4 class="black100">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h4>
              <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
            </button-->

            <a href="https://fatikhov.notion.site/FAQ-Q-RYER-284456a5700880e19e6ee2c92096bc30?source=copy_link" target="_blank" class="cell">
              <img src="{{ url_for('static', filename='img/icon/faq.svg') }}" alt="FAQ" class="icon_24">
              <h4 class="black100">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</h4>

              <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
            </a>

            <a href="https://t.me/fuzlan" target="_blank" class="cell">
              <img src="{{ url_for('static', filename='img/icon/support.svg') }}" alt="Support" class="icon_24">
              <h4 class="black100">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h4>

              <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
            </a>

            
          
          
          
          
          <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–º–µ–Ω—ã -->
          <button id="endShiftBtn" class="action_button" style="background-color: #ff4444; display: none; margin-top: 12px;">
            <h3 class="white100">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É</h3>
          </button>


          

        </div>
      </div>
    </div>

    <!-- Modal Game Settings -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">

        <!--Modal header-->
        <span class="modal_header">
          <h1 class="black100">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h1>
          <span class="icon_button graybg close" data-close="settingsModal">
            <img src="{{ url_for('static', filename='img/icon/cross.svg') }}" alt="Close" class="icon">
          </span>
        </span>
        

        <!--Radius-->
        <div style="padding: 16px; flex: 1;">
          <div style="margin-bottom: 24px;">
            <h4 class="black100" style="margin-bottom: 12px;">–†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤</h4>
            <input type="range" id="searchRadius" min="1" max="25" value="5" 
                   style="width: 100%; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; color: #666; font-size: 14px;">
              <span>1 –∫–º</span>
              <span id="radiusValue">5 –∫–º</span>
              <span>25 –∫–º</span>
            </div>
          </div>


          <h4 class="black100" style="margin-bottom: 12px;">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</h4>
          <!-- –í—ã–±–æ—Ä –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ -->
          <div style="margin-bottom: 24px;">

            <!--Map selector-->
            <button 
              onclick="window.mapServiceSelector?.openModal()" class="cell">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="selectedMapServiceName">2GIS</span>
                
                <img src="{{ url_for('static', filename='img/icon/arrow_right.svg') }}" alt=">" class="icon_24 cell_chevron">
              </div>

                
            </button>
          </div>
          
          <!--Other-->
          <!--div style="margin-bottom: 24px;">
            <h4 class="black100" style="margin-bottom: 12px;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
            <label style="display: flex; align-items: center; justify-content: space-between; padding: 8px 0;">
              <span>–ó–≤—É–∫ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ</span>
              <input type="checkbox" id="soundNotifications" checked>
            </label>
            <label style="display: flex; align-items: center; justify-content: space-between; padding: 8px 0;">
              <span>–í–∏–±—Ä–∞—Ü–∏—è</span>
              <input type="checkbox" id="vibrationNotifications" checked>
            </label>
          </div>
          

          <!--Info-->
          <!--div style="background: #f8f9fa; border-radius: 12px; padding: 16px;">
            <h4 class="black100" style="margin-bottom: 8px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ GPS</h4>
            <div style="color: #666; font-size: 14px;">
              <div>–¢–æ—á–Ω–æ—Å—Ç—å: <span id="settingsGpsAccuracy">‚Äî</span></div>
              <div>–ö–∞—á–µ—Å—Ç–≤–æ: <span id="settingsGpsQuality">‚Äî</span></div>
            </div>
          </div-->

        </div>
      </div>
    </div>

    <!-- Modal Order Found - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ settingsModal -->
    <div id="orderModal" class="modal">
      <div class="modal-content">

        <!--Modal header-->
        <span class="modal_header">
          <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
            <h1 id="orderPayout" class="black100">$1000000</h1>
          </div>
          
          <!--Close-->
          <span class="icon_button graybg close" data-close="orderModal">
            <img src="{{ url_for('static', filename='img/icon/cross.svg') }}" alt="Close" class="icon">
          </span>
        </span>
        

        <!--Modal body-->
        <div style="display: flex; flex-direction: column; gap: 24px; padding: 0px 16px 16px 16px;">


          <!--Adress information-->
          <div style="display: flex; flex-direction: column; gap: 0px;">

            <!--Pickup-->
            <span style="display: flex; flex-direction: row; gap: 4px; ">

              <span class="bg-black100" style="display: flex; align-items: center; justify-content: center; border-radius: 1000px; width: 20px; height: 20px;">
                <img src="{{ url_for('static', filename='img/icon/bag_white.svg') }}" style="width: 14px; height: 14px; ">
              </span>

              <p class="black100" id="orderPickupName">KFC Almaly</p>
            </span>

            <span class="bg-black100" style="display: block; width: 2px; height: 16px; margin-left: 9px;"></span>

            <!--Dropoff-->
            <span style="display: flex; flex-direction: row; gap: 4px; ">

              <span class="bg-black100" style="display: flex; align-items: center; justify-content: center; border-radius: 1000px; width: 20px; height: 20px;">
                <img src="{{ url_for('static', filename='img/icon/home_white.svg') }}" style="width: 14px; height: 14px; ">
              </span>

              <p class="black100" id="orderDropoffAddress">KFC Almaly</p>
            </span>


          </div>
          
          <!-- Order_details -->
          <div style="display: flex; flex-direction: row; gap: 8px; margin-bottom: 8px;">

            <!--Distance-->
            <span style="display: flex;flex-direction: row; align-items: center;  gap: 4px;">
              <img src="{{ url_for('static', filename='img/icon/distance.svg') }}" class="icon_20">
              <p class="black100" id="orderDistance">2.3 –∫–º</p>
            </span>

            <p class="black100">¬∑</p>

            <!--Time-->
            <span style="display: flex; flex-direction: row; align-items: center;  gap: 4px;">
              <img src="{{ url_for('static', filename='img/icon/time.svg') }}" class="icon_20">
              <p class="black100" id="orderTime">~15 –º–∏–Ω</p>
            </span>

          </div>
            

          <!-- Action_block -->
          <div style="margin-top: auto; display: flex; gap: 12px;">
            <button class="accept-btn action_button">
              <h3 class="white100">–í–∑—è—Ç—å –∑–∞–∫–∞–∑</h3>
            </button>
          </div>


        </div>
      </div>
    </div>

    <!--Profile Button-->
    <button id="profileButton" class="icon_button">
      <img src="{{ url_for('static', filename='img/icon/user.svg') }}" alt="Profile Icon" class="icon">
    </button>

    <!--Main Action Button (Start Shift)-->
    <button id="startGame" class="action_button" style="background-color: #ff6600;">
      <h3 class="white100">–†–∞–∑—Ä–µ—à–∏—Ç—å GPS</h3>
    </button>

    <!--Settings Button-->
    <button class="icon_button" onclick="openModal('settingsModal')">
      <img src="{{ url_for('static', filename='img/icon/filter.svg') }}" alt="Settings Icon" class="icon">
    </button>

    <!--Center on User Button-->
    <button id="centerLocationButton" class="icon_button myloc">
      <img src="{{ url_for('static', filename='img/icon/target.svg') }}" alt="My Location Icon" class="icon">
    </button>

  </div>

  <!--Order Status Block-->
  <div id="orderStatusBlock" class="order-status-block" style="display: none;">
    <div class="order-status-content">
      <div class="order-status-header">
        <span class="order-status-icon bg-black100">
          <img src="{{ url_for('static', filename='img/icon/bag_white.svg') }}" alt="Bag" class="icon_20">
        </span>
        <h2 class="black100">–ó–∞–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑</h2>
      </div>
      <p class="black100 order-status-text">–ù–∞–ø—Ä–∞–≤–ª—è–π—Ç–µ—Å—å –≤ –∑–æ–Ω—É –ø–æ–ª—É—á–µ–Ω–∏—è</p>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ -->
  <div id="mapServiceModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal_header" style="justify-content: flex-start; gap: 8px;">

        <!-- Back -->
        <span class="icon_button graybg" onclick="closeModal('mapServiceModal'); openModal('settingsModal');">
          <img src="{{ url_for('static', filename='img/icon/arrow_left.svg') }}" alt="Back" class="icon">
        </span>

        <h2>–ö–∞—Ä—Ç—ã</h2>

      </div>
      
      <div style="padding: 16px; flex: 1;">
        <h4 class="black100">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:</h4>
        
        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;">

          <!--2gis-->
          <div class="cell" data-service="2gis">
            
            <label for="service-2gis" style="display: flex; align-items: center; gap: 8px;">
              <img src="{{ url_for('static', filename='img/map_icons/2gis.png') }}" alt="2GIS" class="cell_icon">
              <h4 class="black100">2GIS</h4>
            </label>

            <input type="radio" id="service-2gis" name="mapService" value="2gis" class="cell_radio">
          </div>
          
          <!--Yandex Maps-->
          <div class="cell" data-service="yandex">
            
            <label for="service-yandex" style="display: flex; align-items: center; gap: 8px;">
              <img src="{{ url_for('static', filename='img/map_icons/yandex.png') }}" alt="–Ø–Ω–¥–µ–∫—Å" class="cell_icon">

              <h4 class="black100">–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã</h4>
            </label>

            <input type="radio" id="service-yandex" name="mapService" value="yandex" class="cell_radio">
          </div>
          
          <!--Organic Maps-->
          <div class="cell" data-service="organic">
            
            <label for="service-organic" style="display: flex; align-items: center; gap: 8px;">
              <img src="{{ url_for('static', filename='img/map_icons/organic.png') }}" alt="Organic Maps" class="cell_icon">
              
              <h4 class="black100">Organic Maps</h4>
            </label>

            <input type="radio" id="service-organic" name="mapService" value="organic" class="cell_radio">
          </div>
        </div>
      </div>
      
      <div style="width: 100%; display: flex; justify-content: center; align-items: center; padding: 16px;">
        <button class="action_button" onclick="window.mapServiceSelector?.saveSelection()">
          <h3 class="white100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</h3>
        </button>
      </div>
    </div>
  </div>

  <!--Mapbox Map Container-->
  <div id="map"></div>

{% endblock %}

{% block scripts %}
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Mapbox (–≤–µ—Ä—Å–∏—è v3.0.0) -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js"></script>

  <!-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω Mapbox (–ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏) -->
  <script>
    if (typeof mapboxgl !== 'undefined') {
      mapboxgl.accessToken = "{{ mapbox_token }}";
      console.log("‚úÖ Mapbox —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
    } else {
      console.error("‚ùå Mapbox GL –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
    }
  </script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –ø–µ—Ä–≤—ã–º) -->
  <script src="{{ url_for('static', filename='js/geolocation.js') }}"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ -->
  <script src="{{ url_for('static', filename='js/loader.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/gameState.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/stateManager.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/mapManager.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/orderModal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/shiftManager.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/socketManager.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/mapServiceSelector.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modules/orderStatusBanner.js') }}"></script>

  <!-- –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª -->
  <script src="{{ url_for('static', filename='js/game.js') }}"></script>
  <!-- Debug —É—Ç–∏–ª–∏—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è development) -->
  <script src="{{ url_for('static', filename='js/debug.js') }}"></script>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ -->
  <script>
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞ –ø–æ–∏—Å–∫–∞
    document.addEventListener('DOMContentLoaded', () => {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
      if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
        document.getElementById('debugPanel').style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        setInterval(() => {
          const debugGPS = document.getElementById('debugGPS');
          const debugState = document.getElementById('debugState');
          const debugButton = document.getElementById('debugButton');
          
          if (window.geoManager && debugGPS) {
            debugGPS.textContent = window.geoManager.currentPosition ? '‚úÖ' : '‚ùå';
          }
          
          if (window.gameState && debugState) {
            debugState.textContent = `shift:${window.gameState.isOnShift} search:${window.gameState.isSearching}`;
          }
          
          if (debugButton) {
            const button = document.getElementById('startGame');
            if (button) {
              debugButton.textContent = button.querySelector('h3').textContent.slice(0, 15);
            }
          }
        }, 1000);
      }
      
      const radiusSlider = document.getElementById('searchRadius');
      const radiusValue = document.getElementById('radiusValue');
      
        if (radiusSlider && radiusValue) {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const savedRadius = localStorage.getItem('search_radius_km') || '5';
        radiusSlider.value = savedRadius;
        radiusValue.textContent = savedRadius + ' –∫–º';
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        radiusSlider.addEventListener('input', (e) => {
          radiusValue.textContent = e.target.value + ' –∫–º';
        });
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        radiusSlider.addEventListener('change', async (e) => {
          const newRadius = parseInt(e.target.value);
          const userId = window.gameState?.userId;
          if (!userId) return;
          
          try {
            const res = await fetch('/api/search_radius', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({user_id: userId, radius_km: newRadius})
            });
            const result = await res.json();
            if (result.success) {
              localStorage.setItem('search_radius_km', newRadius);
              console.log(`‚úÖ –†–∞–¥–∏—É—Å: ${newRadius} –∫–º`);
            }
          } catch (e) { console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞–¥–∏—É—Å–∞', e); }
        });
      }
      
      // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É"
      const profileButton = document.getElementById("profileButton");
      if (profileButton) {
        profileButton.addEventListener("click", () => {
          const endShiftBtn = document.getElementById("endShiftBtn");
          if (endShiftBtn && window.gameState) {
            endShiftBtn.style.display = window.gameState.isOnShift ? "flex" : "none";
          }
        });
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ GPS –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
      setInterval(() => {
        if (window.geoManager && window.geoManager.currentPosition) {
          const accuracy = window.geoManager.currentPosition.coords.accuracy;
          const quality = window.geoManager.getGPSQuality();
          
          const accuracyEl = document.getElementById('settingsGpsAccuracy');
          const qualityEl = document.getElementById('settingsGpsQuality');
          const profileGpsEl = document.getElementById('profileGpsStatus');
          
          if (accuracyEl) accuracyEl.textContent = Math.round(accuracy) + ' –º';
          if (qualityEl) {
            qualityEl.textContent = {
              'excellent': '–û—Ç–ª–∏—á–Ω–æ–µ',
              'good': '–•–æ—Ä–æ—à–µ–µ', 
              'fair': '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ',
              'poor': '–ü–ª–æ—Ö–æ–µ'
            }[quality] || quality;
          }
          if (profileGpsEl) {
            profileGpsEl.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω';
            profileGpsEl.style.color = '#00aa44';
          }
        }
      }, 2000);
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ API
fetch('/api/app_info')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –≤ –º–æ–¥–∞–ª–∫–µ
      const versionElements = document.querySelectorAll('#profileSettingsModal p.black60');
      versionElements.forEach(el => {
        if (el.textContent.includes('v')) {
          el.textContent = 'v' + data.data.version;
        }
      });
      console.log('‚úÖ –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', data.data.version);
    }
  })
  .catch(error => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–∏:', error));
  </script>
  <!-- City Selector JS -->
  <script src="{{ url_for('static', filename='js/city_selector.js') }}"></script>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async () => {
      const citySelector = new CitySelector();
      const selectedCity = await citySelector.init();
      console.log('–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ –≥–æ—Ä–æ–¥–µ:', selectedCity);
    });
  </script>
{% endblock %}
